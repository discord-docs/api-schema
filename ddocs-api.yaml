openapi: 3.1.0
info:
  title: DDocs API
  version: '1.0'
servers:
  - url: 'https://api.ddocs.io'
    description: Main site
paths:
  /auth/login:
    get:
      summary: Login
      tags: []
      responses:
        '200':
          description: The authentication was successful
          headers:
            Set-Cookie:
              schema:
                type: string
              description: The refresh cookie with the name r_
          content:
            application/json:
              schema:
                type: object
                properties:
                  token:
                    type: string
                    description: The JWT Token
        '400':
          description: 'The `code` parameter couldn''t be validated '
      operationId: get-auth-login
      description: Accepts a Discord OAuth code and creates a new jwt session and refresh token for the user
      parameters:
        - schema:
            type: string
          in: query
          name: code
          description: The discord OAuth code
    parameters: []
  /auth/refresh:
    get:
      summary: Refresh
      tags: []
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  token:
                    type: string
                    description: The new JWT token
        '400':
          description: |
            This can happen for multiple reasons:
            - The JWT token used for this request was still valid.
            - The refresh token provided was invalid.
        '401':
          description: No refresh token was provided.
      operationId: get-auth-refresh
      description: Refreshes a JWT token
      parameters:
        - schema:
            type: string
          in: header
          name: Cookie
          description: The provided r_ cookie to refresh with
  /users/@me:
    get:
      summary: Get current user
      tags: []
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
              examples:
                example-1:
                  value:
                    id: '259053800755691520'
                    username: quin
                    discriminator: '3017'
                    avatar: 'https://cdn.discordapp.com/avatars/259053800755691520/1b1a1c1a62756406ebb3319138e08d4b.png?size=128'
                    isAuthor: true
        '401':
          description: 'Unauthorized: refresh your token'
        '403':
          description: 'Forbidden: The discord oauth is no longer valid, please sign in again.'
        '404':
          description: The user was not found? treat as 403
      operationId: get-users-@me
      description: Gets the current user
      security:
        - JWT: []
components:
  schemas:
    User:
      title: User
      type: object
      properties:
        id:
          type: string
        username:
          type: string
        discriminator:
          type: string
        avatar:
          type: string
        isAuthor:
          type: boolean
  securitySchemes:
    JWT:
      type: http
      scheme: bearer
